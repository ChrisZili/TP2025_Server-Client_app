{% extends "layout.html" %}

{% block stylesheet %}
{{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/photo_add.css') }}">
{% endblock %}

{% block title %}
Moji Lekári - Fotky
{% endblock %}

{% block header %}
Fotky
{% endblock %}

{% block content %}
<div id="fotky-container" class="fotky-container">
  <form action="{{ url_for('photos_add') }}" method="POST" enctype="multipart/form-data" class="form-container">
    
    <!-- First dropdown menu for patients -->
    <div class="form-group">
      <label for="patient">Pacient:</label>
      <select id="patient" name="patient" class="form-input" required>
        <option value="" disabled selected>Vyberte pacienta</option>
      </select>

        <label for="eye">Oko:</label>
        <select id="eye" name="eye" class="form-input" required>
          <option value="right">Pravé oko</option>
          <option value="left">Ľavé oko</option>
        </select>

    <div class="form-group">
      <label for="diagnostic">Typ obrazu:</label>
      <input type="text" id="diagnostic" name="diagnostic" placeholder="Zadajte diagnostiku" class="form-input" required>
    </div>

    <div class="form-group">
      <label for="variant">Typ zariadenia:</label>
      <input type="text" id="variant" name="variant" placeholder="Zadajte variant produktu" class="form-input" required>
    </div>

    <div class="form-group">
      <label for="zariadenie">Typ kamery:</label>
      <input type="text" id="zariadenie" name="zariadenie" placeholder="Zadajte typ kamery" class="form-input" required>
    </div>
    
    <!-- Dynamically generated checkboxes for medical methods -->
    <div class="form-group">
      <div class="checkbox-container">
        {% for method in medical_methods %}
          <div class="checkbox-group">
            <input type="checkbox" id="method-{{ method.name }}" name="methods" value="{{ method.name }}">
            <label for="method-{{ method.name }}">{{ method.name }}</label>
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="form-group">
      <div id="photo-preview-container" class="photo-preview-container">
        <img id="photo-preview" src="#" alt="Photo Preview" class="photo-preview">
      </div>

      <p id="file-name" class="file-name"> <!-- Hide the file name by default -->
      </p>
    </div>

    <div class="form-group button-group">
      <!-- Styled button for selecting a photo -->
      <button type="button" id="select-photo-button" class="action-button select-photo-button">
        Vyberte fotku
      </button>
      <input type="file" id="photo" name="photo" accept="image/*" class="hidden-input" required>

      <!-- Submit button -->
      <button type="submit" id="upload-button" class="action-button upload-photo-button">Nahrajte fotku</button>

      <!-- Proper button for returning to the photos list -->
      <button type="button" id="back-to-list-button" class="action-button back-to-list-button" onclick="window.location.href='{{ url_for('photos_list') }}'">
        Späť na zoznam
      </button>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/photos_add.js') }}"></script>
  <script>
    const patients = {{ patients|tojson }};
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const patientDropdown = document.getElementById("patient");
      const uniquePatients = [...new Set(patients.map(patient => `${patient.first_name} ${patient.last_name}`))];

      uniquePatients.forEach(patientName => {
        const option = document.createElement("option");
        option.value = patientName;
        option.textContent = patientName;
        patientDropdown.appendChild(option);
      });
    });
  </script>
{% endblock %}